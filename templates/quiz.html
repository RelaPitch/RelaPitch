{% extends "base.html" %}

{% block title %}Question {{ question_id }}{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h2 class="text-center mb-0">Question {{ question_id }} of {{ total_questions }}</h2>
                </div>
                <div class="card-body">
                    {% if question.type == 'listen' %}
                    <div class="listen-section">
                        <h3>Listen Mode</h3>
                        <div class="reference-note mb-4">
                            <h4>Reference Note: {{ question.reference_note }}</h4>
                            <button id="playReference" class="btn btn-primary">Play Reference Note</button>
                        </div>

                        <div class="target-note mb-4">
                            <h4>Target Note</h4>
                            <button id="playTarget" class="btn btn-primary">Play Target Note</button>
                            <div class="note-options mt-3">
                                {% for note in question.options %}
                                <button class="btn btn-outline-primary note-btn" data-note="{{ note }}">{{ note }}</button>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <div class="sing-section">
                        <h3>Sing Mode</h3>
                        <div class="reference-note mb-4">
                            <h4>Reference Note: {{ question.reference_note }}</h4>
                            <button id="playReferenceSing" class="btn btn-primary">Play Reference Note</button>
                        </div>

                        <div class="target-note mb-4">
                            <h4>Target Note: {{ question.target_note[0] }}</h4>
                            <button id="startTuner" class="btn btn-primary">Start Recording</button>
                            <div id="tunerDisplay" class="mt-3">
                                <div id="pitch"></div>
                                <div id="note"></div>
                                <canvas id="tunerCanvas"></canvas>
                            </div>
                            <button id="submitRecording" class="btn btn-success mt-3" disabled>Submit Recording</button>
                        </div>
                    </div>
                    {% endif %}

                    <div class="navigation-buttons text-center mt-4">
                        {% if question_id < total_questions %}
                        <button class="btn btn-primary" id="nextButton" disabled data-next-url="{{ url_for('quiz', question_id=question_id+1) }}">Next</button>
                        {% else %}
                        <button class="btn btn-success" id="finishButton" disabled data-finish-url="{{ url_for('quiz_results') }}">Finish Quiz</button>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Pass question data to JavaScript -->
<script type="application/json" id="questionData">
{
    "id": {{ question_id }},
    "type": "{{ question.type }}",
    "reference_note": "{{ question.reference_note }}",
    "target_note": "{{ question.target_note }}",
    "options": {{ question.options|tojson }}
}
</script>
{% endblock %}

{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
<script src="{{ url_for('static', filename='js/tuner.js') }}"></script>
<script src="{{ url_for('static', filename='js/quiz.js') }}"></script>
{% endblock %} 